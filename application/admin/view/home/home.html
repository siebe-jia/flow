<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>校园网流量账号管理系统后台</title>
	<link rel="stylesheet" href="/static/layui/css/layui.css">
	<style>
		/*
			左侧导航栏宽度在原基础上减少40px
			*/
		.layui-layout-admin .layui-side {
			top: 60px;
			width: 160px;
		}

		.layui-side-scroll {
			position: relative;
			width: 180px;
			height: 100%;
			overflow: hidden;
		}

		.layui-body {
			position: absolute;
			left: 160px;
			right: 0;
			z-index: 998;
			width: auto;
			overflow: hidden;
			overflow-y: auto;
			box-sizing: borderbox;
		}

		.layui-layout-admin .layui-footer {
			position: fixed;
			left: 160px;
			right: 0;
			bottom: 0;
			height: 44px;
			line-height: 44px;
			padding: 0 15px;
			background-color: #eee;
		}
	</style>
</head>

<body class="layui-layout-body">
	<div class="layui-layout layui-layout-admin">
		<div class="layui-header">
			<div class="layui-logo">校园网流量账号管理系统</div>
			<!-- 头部区域（可配合layui已有的水平导航） -->
			<!-- <ul class="layui-nav layui-layout-left" >
					<li class="layui-nav-item"><a href="">控制台</a></li>
					<li class="layui-nav-item"><a href="">商品管理</a></li>
					<li class="layui-nav-item"><a href="">用户</a></li>
					<li class="layui-nav-item">
						<a href="javascript:;">其它系统</a>
						<dl class="layui-nav-child">
							<dd><a href="">邮件管理</a></dd>
							<dd><a href="">消息管理</a></dd>
							<dd><a href="">授权管理</a></dd>
							<dd><a data-url="a" data-id="1155" data-title="选项a" href="#" class="site-demo-active" data-type="tabAdd">选项a</a></dd>
						</dl>
					</li>
				</ul> -->
			<ul class="layui-nav layui-layout-right">
				<li class="layui-nav-item">
					<a href="javascript:;" id="admin">
						<img src="/static/img/header.jpg" class="layui-nav-img">{$username}
					</a>
					<!-- <dl class="layui-nav-child">
						<dd><a href="">基本资料</a></dd>
						<dd><a href="">安全设置</a></dd>
					</dl> -->
				</li>
				<li class="layui-nav-item"><a href="logout.php">退出</a></li>
			</ul>
		</div>

		<div class="layui-side layui-bg-black">
			<div class="layui-side-scroll">
				<!-- 左侧导航区域（可配合layui已有的垂直导航） -->
				<ul class="layui-nav layui-nav-tree" lay-filter="demo">
					<li class="layui-nav-item"><a data-url="main" data-id="11" data-title="概况" href="#" class="site-demo-active" data-type="tabAdd">概况</a></li>
					<li class="layui-nav-item"><a data-url="record/table" data-id="12" data-title="账号管理" href="#" class="site-demo-active" data-type="tabAdd">账号管理</a></li>
					<li class="layui-nav-item"><a data-url="user/table" data-id="13" data-title="用户管理" href="#" class="site-demo-active" data-type="tabAdd">用户管理</a></li>
					<li class="layui-nav-item"><a data-url="review/table" data-id="14" data-title="待审核" href="#" class="site-demo-active" data-type="tabAdd" id="layui-badge-dot">待审核</a></li>
					<!-- <li class="layui-nav-item ">
							<a class="" href="javascript:;">所有商品</a>
							<dl class="layui-nav-child">
								<dd><a href="javascript:;">列表一</a></dd>
								<dd><a href="javascript:;">列表二</a></dd>
								<dd><a href="javascript:;">列表三</a></dd>
								<dd><a href="">超链接</a></dd>
							</dl>
						</li>
						<li class="layui-nav-item layui-nav-itemed">
							<a href="javascript:;">解决方案</a>
							<dl class="layui-nav-child">
								<dd><a href="javascript:;">列表一</a></dd>
								<dd><a href="javascript:;">列表二</a></dd>
								<dd>
									<a data-url="a" data-id="11" data-title="选项a" href="#" class="site-demo-active" data-type="tabAdd">选项a</a>
								</dd>
								<dd>
									<a href="#" data-url="b" data-title="选项b" data-id="22" class="site-demo-active" data-type="tabAdd">选项b</a>
								</dd>
								<dd><a href="">超链接</a></dd>
							</dl>
						</li> -->
				</ul>
			</div>
		</div>
		<div class="layui-body" id="container">
			<!-- 内容主体区域 -->
			<!-- <div style="padding: 15px;">内容主体区域</div> -->
			<div class="layui-tab" lay-filter="demo" lay-allowClose="true">
				<ul class="layui-tab-title">
					<li class="layui-this" lay-id="11">概况</li>
				</ul>
				<ul class="rightmenu" style="display: none;position: absolute;">
					<li data-type="closethis">关闭当前</li>
					<li data-type="closeall">关闭所有</li>
				</ul>
				<div class="layui-tab-content">
					<div class="layui-tab-item layui-show">1</div>

				</div>
			</div>
		</div>

		<div class="layui-footer">
			<!-- 底部固定区域 -->
			Copyright © 2019 大学生网络信息中心. All Rights Reserved
		</div>
	</div>
	<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
	<!--[if lt IE 9]>
     		<script src="/static/html5shiv/html5shiv.min.js"></script>
	 		<script src="/static/respond/respond.min.js"></script>
		<![endif]-->
	<script src="/static/layui/layui.js"></script>
	<script>
		//JavaScript代码区域
		layui.use(['jquery', 'layer', 'element'], function () {
			var $ = layui.jquery, layer = layui.layer, element = layui.element;
			//Tab的切换功能，切换事件监听等，需要依赖element模块
            layer.msg("欢迎管理员回来！", { icon: 6 });
			$.get("./review/count", {},
				function (data) {
			    if (data.count > 0){
                    $("#layui-badge-dot").append('<span class="layui-badge-dot"></span>');
				}
				}, "json").fail(function (res) {
					layer.msg(res.responseJSON.msg, { icon: 0 });
				});
			//一些事件监听
			//Tab选项卡点击切换时触发，回调函数返回一个object参数，携带两个成员
			element.on('tab(demo)', function (data) {
				//console.log(data);
				//console.log(this); //当前Tab标题所在的原始DOM元素
				//console.log(data.index); //得到当前Tab的所在下标
				//console.log(data.elem); //得到当前的Tab大容器
			});
			//Tab选项卡被删除时触发，回调函数返回一个object参数，携带两个成员：
			element.on('tabDelete(demo)', function (data) {
				//console.log(this); //当前Tab标题所在的原始DOM元素
				//console.log(data.index); //得到当前Tab的所在下标
				//console.log(data.elem); //得到当前的Tab大容器
			});
			//当点击导航父级菜单和二级菜单时触发，回调函数返回所点击的菜单DOM对象：
			element.on('nav(demo)', function (elem) {
				//console.log(elem); //得到当前点击的DOM对象
			});
			//当折叠面板点击展开或收缩时触发，回调函数返回一个object参数，携带三个成员：
			element.on('collapse(demo)', function (data) {
				//console.log(data.show); //得到当前面板的展开状态，true或者false
				//console.log(data.title); //得到当前点击面板的标题区域DOM对象
				//console.log(data.content); //得到当前点击面板的内容区域DOM对象
			});
			//触发事件
			var active = {
				//在这里给active绑定几项事件，后面可通过active调用这些事件
				tabAdd: function (url, id, name) {
					//新增一个Tab项 传入三个参数，分别对应其标题，tab页面的地址，还有一个规定的id，是标签中data-id的属性值
					//关于tabAdd的方法所传入的参数可看layui的开发文档中基础方法部分
					element.tabAdd('demo', {
						title: name,//选项卡的标题
						content: '<iframe data-frameid="' + id + '" scrolling="auto" frameborder="0" src="' + url +
							'.html" style="width:100%;height:99%;"></iframe>',//支持传入html
						id: id //选项卡标题的lay-id属性值
					})
					CustomRightClick(id);//绑定右键菜单
					FrameWH(); //计算ifram层的大小
				},
				tabChange: function (id) {
					//切换到指定Tab项
					element.tabChange('demo', id); //根据传入的id传入到指定的tab项
				},
				tabDelete: function (id) {
					element.tabDelete("demo", id); //删除
				},
				tabDeleteAll: function (ids) { //删除所有
					$.each(ids, function (i, item) {
						element.tabDelete("demo", item); //ids是一个数组，里面存放了多个id，调用tabDelete方法分别删除
					})
				}
			};
			//当点击有site-demo-active属性的标签时，即左侧菜单栏中内容 ，触发点击事件
			$('.site-demo-active').on('click', function () {
				var dataid = $(this);
				//这时会判断右侧.layui-tab-title属性下的有lay-id属性的li的数目，即已经打开的tab项数目
				if ($(".layui-tab-title li[lay-id]").length <= 0) {
					//如果比零小，则直接打开新的tab项
					active.tabAdd(dataid.attr("data-url"), dataid.attr("data-id"), dataid.attr("data-title"));
				} else {
					//否则判断该tab项是否以及存在
					var isData = false; //初始化一个标志，为false说明未打开该tab项 为true则说明已有
					$.each($(".layui-tab-title li[lay-id]"), function () {
						//如果点击左侧菜单栏所传入的id 在右侧tab项中的lay-id属性可以找到，则说明该tab项已经打开
						if ($(this).attr("lay-id") == dataid.attr("data-id")) {
							isData = true;
						}
					})
					if (isData == false) {
						//标志为false 新增一个tab项
						active.tabAdd(dataid.attr("data-url"), dataid.attr("data-id"), dataid.attr("data-title"));
					}
				}
				//最后不管是否新增tab，最后都转到要打开的选项页面上
				active.tabChange(dataid.attr("data-id"));
			});
			function FrameWH() {
				var h = $(window).height() - 60 - 41 - 10 - 20 - 54 ;//- 60 - 41 - 10 - 20 - 44 -13
				$("iframe").css("height", h + "px");
			}
			//在tab标签上增加了右键功能
			function CustomRightClick(id) {
				//取消右键  rightmenu属性开始是隐藏的 ，当右击的时候显示，左击的时候隐藏
				$('.layui-tab-title li').on('contextmenu', function () { return false; })
				$('.layui-tab-title,.layui-tab-title li').click(function () {
					$('.rightmenu').hide();
				});
				//桌面点击右击 
				$('.layui-tab-title li').on('contextmenu', function (e) {
					//console.log(e)
					var popupmenu = $(".rightmenu");
					popupmenu.find("li").attr("data-id", id); //在右键菜单中的标签绑定id属性

					//判断右侧菜单的位置 
					l = ($(document).width() - e.clientX) < popupmenu.width() ? (e.clientX - popupmenu.width()) : e.clientX;
					t = ($(document).height() - e.clientY) < popupmenu.height() ? (e.clientY - popupmenu.height()) : e.clientY;
					popupmenu.css({ left: l, top: t }).show(); //进行绝对定位
					//alert("右键菜单")
					return false;
				});
			}
			//右键菜单有了，就需要给右键添加功能
			$(".rightmenu li").click(function () {
				//右键菜单中的选项被点击之后，判断type的类型，决定关闭所有还是关闭当前。
				if ($(this).attr("data-type") == "closethis") {
					//如果关闭当前，即根据显示右键菜单时所绑定的id，执行tabDelete
					active.tabDelete($(this).attr("data-id"))
				} else if ($(this).attr("data-type") == "closeall") {
					var tabtitle = $(".layui-tab-title li");
					var ids = new Array();
					$.each(tabtitle, function (i) {
						ids[i] = $(this).attr("lay-id");
					})
					//如果关闭所有 ，即将所有的lay-id放进数组，执行tabDeleteAll
					active.tabDeleteAll(ids);
				}
				$('.rightmenu').hide(); //最后再隐藏右键菜单
			})

			$(window).resize(function () {
				FrameWH();
			})
		});
	</script>
</body>

</html>